{"version":3,"file":"6.f62dc3bde9e6060449d8.hot-update.js","sources":["webpack:///pages/asset/viewdetail.js"],"sourcesContent":["import React, { Component } from 'react';\nimport { Table, Button, Message } from 'semantic-ui-react';\nimport * as superagent from 'superagent';\n\nimport Layout from '../../components/Layout';\nimport web3 from '../../ethereum/web3';\nimport WhiskyAsset from '../../ethereum/whiskyAsset';\n\nclass ViewDetail extends Component {\n  state = {\n    loadingListForSale: false,\n    loadingBuyAsset: false,\n    errorMessage: ''\n  }\n\n  static async getInitialProps(props) {\n    const assetId = props.query.id;\n    return { assetId }\n  }\n\n  constructor(props) {\n    super(props);\n    this.state = {};\n  }\n\n  async componentDidMount() {\n    const detail = await superagent.get(`http://${window.location.host}/api/viewdetail/${this.props.assetId}`)\n    .then(res => res.body)\n    this.setState(detail[0]);\n    const whiskyAsset = WhiskyAsset(detail[0].contractAddress);\n    const etherValue = await whiskyAsset.methods.value().call();\n    const accounts = await web3.eth.getAccounts();\n    this.state.owner === accounts[0] ? this.setState({isOwner:true}) : this.setState({isOwner:false});\n    const selling = await whiskyAsset.methods.selling().call();\n    this.setState({\n      selling,\n      etherValue:  web3.utils.fromWei(etherValue),\n    });\n  }\n\n  listForSale = async () => {\n    const whiskyAsset = WhiskyAsset(this.state.contractAddress);\n    console.log('contract address: ',this.state.contractAddress);\n    console.log('contract owner: ',await whiskyAsset.methods.owner().call());\n    this.setState({loading: true, errorMessage: ''});\n    try {\n      const accounts = await web3.eth.getAccounts();\n      const res = await whiskyAsset.methods.initiateSale().send({\n        from: accounts[0]\n      });\n      console.log('res: ', res);\n      this.setState({selling: true});\n    } catch (error) {\n      this.setState({ errorMessage: error.message });\n    }\n    this.setState({loading: false});\n  }\n\n  buyAsset = async () => {\n    const whiskyAsset = WhiskyAsset(this.state.contractAddress);\n    this.setState({loading: true, errorMessage: ''});\n    try {\n      const accounts = await web3.eth.getAccounts();\n      const res = await whiskyAsset.methods.buyWhisky().send({\n        from: accounts[0],\n        value: web3.utils.toWei(this.state.etherValue)\n      });\n      console.log('res: ', res);\n      const owner = await whiskyAsset.methods.owner().call();\n      superagent.patch(`http://${window.location.host}/api/update/${this.state._id}`, {owner}).then(async res => {\n      }).catch (err => console.error(err.stack));\n      this.setState({owner});\n    } catch (error) {\n      this.setState({ errorMessage: error.message });\n    }\n    this.setState({loading: false});\n  }\n\n  render() {\n    const detail = this.state;\n    console.log('selling: ', this.state.selling);\n    console.log('isowner: ', this.state.isOwner);\n    return (\n      <Layout>\n      <h3>Whisky Detail</h3>\n        <Table definition>\n          <Table.Body>\n            <Table.Row>\n              <Table.Cell>Name</Table.Cell>\n              <Table.Cell>{detail.name}</Table.Cell>\n            </Table.Row>\n            <Table.Row>\n              <Table.Cell>Producer</Table.Cell>\n              <Table.Cell>{detail.producer}</Table.Cell>\n            </Table.Row>\n            <Table.Row>\n              <Table.Cell>Country</Table.Cell>\n              <Table.Cell>{detail.country}</Table.Cell>\n            </Table.Row>\n            <Table.Row>\n              <Table.Cell>Region</Table.Cell>\n              <Table.Cell>{detail.region}</Table.Cell>\n            </Table.Row>\n            <Table.Row>\n              <Table.Cell>Subregion</Table.Cell>\n              <Table.Cell>{detail.subregion}</Table.Cell>\n            </Table.Row>\n            <Table.Row>\n              <Table.Cell>Size</Table.Cell>\n              <Table.Cell>{detail.size}</Table.Cell>\n            </Table.Row>\n            <Table.Row>\n              <Table.Cell>Color</Table.Cell>\n              <Table.Cell>{detail.color}</Table.Cell>\n            </Table.Row>\n            <Table.Row>\n              <Table.Cell>Year</Table.Cell>\n              <Table.Cell>{detail.year}</Table.Cell>\n            </Table.Row>\n            <Table.Row>\n              <Table.Cell>Degree of Alcohol</Table.Cell>\n              <Table.Cell>{detail.degreeOfAlcohol}</Table.Cell>\n            </Table.Row>\n            <Table.Row>\n              <Table.Cell>Wood Type</Table.Cell>\n              <Table.Cell>{detail.woodType}</Table.Cell>\n            </Table.Row>\n            <Table.Row>\n              <Table.Cell>Cask ID</Table.Cell>\n              <Table.Cell>{detail.caskId}</Table.Cell>\n            </Table.Row>\n            <Table.Row>\n              <Table.Cell>Value in USD</Table.Cell>\n              <Table.Cell>{detail.value}</Table.Cell>\n            </Table.Row>\n            <Table.Row>\n              <Table.Cell>Value in Ether</Table.Cell>\n              <Table.Cell>{detail.etherValue}</Table.Cell>\n            </Table.Row>\n            <Table.Row>\n              <Table.Cell>Owner</Table.Cell>\n              <Table.Cell>{detail.owner}</Table.Cell>\n            </Table.Row>\n          </Table.Body>\n        </Table>\n        {/* <Message error header=\"Oops!\" content={this.state.errorMessage} /> */}\n        <Button \n          primary \n          loading={this.state.loadingListForSale}\n          onClick={this.listForSale} \n          disabled={!(this.state.isOwner && !this.state.selling)}\n        >List for Sale</Button>\n        <Button \n          primary \n          loading={this.state.loadingBuyAsset}\n          onClick={this.buyAsset} \n          disabled={!(!this.state.isOwner && this.state.selling)}\n        >Buy</Button>\n      </Layout>\n    );\n  }\n}\n\nexport default ViewDetail;\n\n\n// WEBPACK FOOTER //\n// pages/asset/viewdetail.js"],"mappings":"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","sourceRoot":""}